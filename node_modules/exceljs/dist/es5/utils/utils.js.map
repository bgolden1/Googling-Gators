{"version":3,"sources":["../../../lib/utils/utils.js"],"names":["fs","require","inherits","cls","superCtor","statics","prototype","super_","Object","keys","forEach","i","defineProperty","getOwnPropertyDescriptor","properties","constructor","value","enumerable","writable","configurable","create","utils","nop","promiseImmediate","Promise","resolve","global","setImmediate","setTimeout","dateToExcel","d","date1904","getTime","excelToDate","v","millisecondSinceEpoch","Math","round","Date","parsePath","filepath","last","lastIndexOf","path","substring","name","getRelsPath","xmlEncode","text","replace","c","xmlDecode","validInt","parseInt","Number","isNaN","isDateFmt","fmt","result","match","exists","access","constants","F_OK","err","toIsoDateString","dt","toIsoString","subsstr","module","exports"],"mappings":"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","sourcesContent":["const fs = require('fs');\r\n\r\n// useful stuff\r\nconst inherits = function(cls, superCtor, statics, prototype) {\r\n  // eslint-disable-next-line no-underscore-dangle\r\n  cls.super_ = superCtor;\r\n\r\n  if (!prototype) {\r\n    prototype = statics;\r\n    statics = null;\r\n  }\r\n\r\n  if (statics) {\r\n    Object.keys(statics).forEach(i => {\r\n      Object.defineProperty(cls, i, Object.getOwnPropertyDescriptor(statics, i));\r\n    });\r\n  }\r\n\r\n  const properties = {\r\n    constructor: {\r\n      value: cls,\r\n      enumerable: false,\r\n      writable: false,\r\n      configurable: true,\r\n    },\r\n  };\r\n  if (prototype) {\r\n    Object.keys(prototype).forEach(i => {\r\n      properties[i] = Object.getOwnPropertyDescriptor(prototype, i);\r\n    });\r\n  }\r\n\r\n  cls.prototype = Object.create(superCtor.prototype, properties);\r\n};\r\n\r\nconst utils = {\r\n  nop() {},\r\n  promiseImmediate(value) {\r\n    return new Promise(resolve => {\r\n      if (global.setImmediate) {\r\n        setImmediate(() => {\r\n          resolve(value);\r\n        });\r\n      } else {\r\n        // poorman's setImmediate - must wait at least 1ms\r\n        setTimeout(() => {\r\n          resolve(value);\r\n        }, 1);\r\n      }\r\n    });\r\n  },\r\n  inherits,\r\n  dateToExcel(d, date1904) {\r\n    return 25569 + d.getTime() / (24 * 3600 * 1000) - (date1904 ? 1462 : 0);\r\n  },\r\n  excelToDate(v, date1904) {\r\n    const millisecondSinceEpoch = Math.round((v - 25569 + (date1904 ? 1462 : 0)) * 24 * 3600 * 1000);\r\n    return new Date(millisecondSinceEpoch);\r\n  },\r\n  parsePath(filepath) {\r\n    const last = filepath.lastIndexOf('/');\r\n    return {\r\n      path: filepath.substring(0, last),\r\n      name: filepath.substring(last + 1),\r\n    };\r\n  },\r\n  getRelsPath(filepath) {\r\n    const path = utils.parsePath(filepath);\r\n    return `${path.path}/_rels/${path.name}.rels`;\r\n  },\r\n  xmlEncode(text) {\r\n    // eslint-disable-next-line no-control-regex\r\n    return text.replace(/[<>&'\"\\x7F\\x00-\\x08\\x0B-\\x0C\\x0E-\\x1F]/g, c => {\r\n      switch (c) {\r\n        case '<':\r\n          return '&lt;';\r\n        case '>':\r\n          return '&gt;';\r\n        case '&':\r\n          return '&amp;';\r\n        case '\\'':\r\n          return '&apos;';\r\n        case '\"':\r\n          return '&quot;';\r\n        default:\r\n          return '';\r\n      }\r\n    });\r\n  },\r\n  xmlDecode(text) {\r\n    return text.replace(/&([a-z]*);/, c => {\r\n      switch (c) {\r\n        case '&lt;':\r\n          return '<';\r\n        case '&gt;':\r\n          return '>';\r\n        case '&amp;':\r\n          return '&';\r\n        case '&apos;':\r\n          return '\\'';\r\n        case '&quot;':\r\n          return '\"';\r\n        default:\r\n          return c;\r\n      }\r\n    });\r\n  },\r\n  validInt(value) {\r\n    const i = parseInt(value, 10);\r\n    return !Number.isNaN(i) ? i : 0;\r\n  },\r\n\r\n  isDateFmt(fmt) {\r\n    if (!fmt) {\r\n      return false;\r\n    }\r\n\r\n    // must remove all chars inside quotes and []\r\n    fmt = fmt.replace(/\\[[^\\]]*]/g, '');\r\n    fmt = fmt.replace(/\"[^\"]*\"/g, '');\r\n    // then check for date formatting chars\r\n    const result = fmt.match(/[ymdhMsb]+/) !== null;\r\n    return result;\r\n  },\r\n\r\n  fs: {\r\n    exists(path) {\r\n      return new Promise(resolve => {\r\n        fs.access(path, fs.constants.F_OK, err => {\r\n          resolve(!err);\r\n        });\r\n      });\r\n    },\r\n  },\r\n\r\n  toIsoDateString(dt) {\r\n    return dt.toIsoString().subsstr(0, 10);\r\n  },\r\n};\r\n\r\nmodule.exports = utils;\r\n"],"file":"utils.js"}