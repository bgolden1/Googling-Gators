{"version":3,"sources":["../../../lib/doc/workbook.js"],"names":["Worksheet","require","DefinedNames","XLSX","CSV","Workbook","created","Date","modified","properties","calcProperties","_worksheets","views","media","_definedNames","name","options","id","nextId","length","console","warn","substring","find","ws","toLowerCase","Error","trace","tabColor","argb","theme","indexed","lastOrderNo","reduce","acc","orderNo","worksheetOptions","Object","assign","workbook","worksheet","getWorksheet","destroy","undefined","Boolean","iteratee","worksheets","forEach","sheet","_themes","image","push","type","_xlsx","_csv","i","slice","sort","a","b","filter","creator","lastModifiedBy","lastPrinted","map","model","sheets","definedNames","company","manager","title","subject","keywords","category","description","language","revision","contentStatus","themes","value","worksheetModel","state","findIndex","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nconst Worksheet = require('./worksheet');\r\nconst DefinedNames = require('./defined-names');\r\nconst XLSX = require('./../xlsx/xlsx');\r\nconst CSV = require('./../csv/csv');\r\n\r\n// Workbook requirements\r\n//  Load and Save from file and stream\r\n//  Access/Add/Delete individual worksheets\r\n//  Manage String table, Hyperlink table, etc.\r\n//  Manage scaffolding for contained objects to write to/read from\r\n\r\nclass Workbook {\r\n  constructor() {\r\n    this.created = new Date();\r\n    this.modified = this.created;\r\n    this.properties = {};\r\n    this.calcProperties = {};\r\n    this._worksheets = [];\r\n    this.views = [];\r\n    this.media = [];\r\n    this._definedNames = new DefinedNames();\r\n  }\r\n\r\n  get xlsx() {\r\n    if (!this._xlsx) this._xlsx = new XLSX(this);\r\n    return this._xlsx;\r\n  }\r\n\r\n  get csv() {\r\n    if (!this._csv) this._csv = new CSV(this);\r\n    return this._csv;\r\n  }\r\n\r\n  get nextId() {\r\n    // find the next unique spot to add worksheet\r\n    for (let i = 1; i < this._worksheets.length; i++) {\r\n      if (!this._worksheets[i]) {\r\n        return i;\r\n      }\r\n    }\r\n    return this._worksheets.length || 1;\r\n  }\r\n\r\n  addWorksheet(name, options) {\r\n    const id = this.nextId;\r\n\r\n    if (name && name.length > 31) {\r\n      // eslint-disable-next-line no-console\r\n      console.warn(`Worksheet name ${name} exceeds 31 chars. This will be truncated`);\r\n    }\r\n    name = (name || `sheet${id}`).substring(0, 31);\r\n    if (this._worksheets.find(ws => ws && ws.name.toLowerCase() === name.toLowerCase())) {\r\n      throw new Error(`Worksheet name already exists: ${name}`);\r\n    }\r\n\r\n    // if options is a color, call it tabColor (and signal deprecated message)\r\n    if (options) {\r\n      if (typeof options === 'string') {\r\n        // eslint-disable-next-line no-console\r\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { argb: \"rbg value\" } }');\r\n        options = {\r\n          properties: {\r\n            tabColor: {argb: options},\r\n          },\r\n        };\r\n      } else if (options.argb || options.theme || options.indexed) {\r\n        // eslint-disable-next-line no-console\r\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { ... } }');\r\n        options = {\r\n          properties: {\r\n            tabColor: options,\r\n          },\r\n        };\r\n      }\r\n    }\r\n\r\n    const lastOrderNo = this._worksheets.reduce((acc, ws) => ((ws && ws.orderNo) > acc ? ws.orderNo : acc), 0);\r\n    const worksheetOptions = Object.assign({}, options, {\r\n      id,\r\n      name,\r\n      orderNo: lastOrderNo + 1,\r\n      workbook: this,\r\n    });\r\n\r\n    const worksheet = new Worksheet(worksheetOptions);\r\n\r\n    this._worksheets[id] = worksheet;\r\n    return worksheet;\r\n  }\r\n\r\n  removeWorksheetEx(worksheet) {\r\n    delete this._worksheets[worksheet.id];\r\n  }\r\n\r\n  removeWorksheet(id) {\r\n    const worksheet = this.getWorksheet(id);\r\n    if (worksheet) {\r\n      worksheet.destroy();\r\n    }\r\n  }\r\n\r\n  getWorksheet(id) {\r\n    if (id === undefined) {\r\n      return this._worksheets.find(Boolean);\r\n    }\r\n    if (typeof id === 'number') {\r\n      return this._worksheets[id];\r\n    }\r\n    if (typeof id === 'string') {\r\n      return this._worksheets.find(worksheet => worksheet && worksheet.name === id);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  get worksheets() {\r\n    // return a clone of _worksheets\r\n    return this._worksheets\r\n      .slice(1)\r\n      .sort((a, b) => a.orderNo - b.orderNo)\r\n      .filter(Boolean);\r\n  }\r\n\r\n  eachSheet(iteratee) {\r\n    this.worksheets.forEach(sheet => {\r\n      iteratee(sheet, sheet.id);\r\n    });\r\n  }\r\n\r\n  get definedNames() {\r\n    return this._definedNames;\r\n  }\r\n\r\n  clearThemes() {\r\n    // Note: themes are not an exposed feature, meddle at your peril!\r\n    this._themes = undefined;\r\n  }\r\n\r\n  addImage(image) {\r\n    // TODO:  validation?\r\n    const id = this.media.length;\r\n    this.media.push(Object.assign({}, image, {type: 'image'}));\r\n    return id;\r\n  }\r\n\r\n  getImage(id) {\r\n    return this.media[id];\r\n  }\r\n\r\n  get model() {\r\n    return {\r\n      creator: this.creator || 'Unknown',\r\n      lastModifiedBy: this.lastModifiedBy || 'Unknown',\r\n      lastPrinted: this.lastPrinted,\r\n      created: this.created,\r\n      modified: this.modified,\r\n      properties: this.properties,\r\n      worksheets: this.worksheets.map(worksheet => worksheet.model),\r\n      sheets: this.worksheets.map(ws => ws.model).filter(Boolean),\r\n      definedNames: this._definedNames.model,\r\n      views: this.views,\r\n      company: this.company,\r\n      manager: this.manager,\r\n      title: this.title,\r\n      subject: this.subject,\r\n      keywords: this.keywords,\r\n      category: this.category,\r\n      description: this.description,\r\n      language: this.language,\r\n      revision: this.revision,\r\n      contentStatus: this.contentStatus,\r\n      themes: this._themes,\r\n      media: this.media,\r\n      calcProperties: this.calcProperties,\r\n    };\r\n  }\r\n\r\n  set model(value) {\r\n    this.creator = value.creator;\r\n    this.lastModifiedBy = value.lastModifiedBy;\r\n    this.lastPrinted = value.lastPrinted;\r\n    this.created = value.created;\r\n    this.modified = value.modified;\r\n    this.company = value.company;\r\n    this.manager = value.manager;\r\n    this.title = value.title;\r\n    this.subject = value.subject;\r\n    this.keywords = value.keywords;\r\n    this.category = value.category;\r\n    this.description = value.description;\r\n    this.language = value.language;\r\n    this.revision = value.revision;\r\n    this.contentStatus = value.contentStatus;\r\n\r\n    this.properties = value.properties;\r\n    this.calcProperties = value.calcProperties;\r\n    this._worksheets = [];\r\n    value.worksheets.forEach(worksheetModel => {\r\n      const {id, name, state} = worksheetModel;\r\n      const orderNo = value.sheets && value.sheets.findIndex(ws => ws.id === id);\r\n      const worksheet = (this._worksheets[id] = new Worksheet({\r\n        id,\r\n        name,\r\n        orderNo,\r\n        state,\r\n        workbook: this,\r\n      }));\r\n\r\n      worksheet.model = worksheetModel;\r\n    });\r\n\r\n    this._definedNames.model = value.definedNames;\r\n    this.views = value.views;\r\n    this._themes = value.themes;\r\n    this.media = value.media || [];\r\n  }\r\n}\r\n\r\nmodule.exports = Workbook;\r\n"],"file":"workbook.js"}